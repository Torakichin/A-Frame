<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR 3Dモデル 回転 (タップで)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="chaei" src="Wood_Table.glb"></a-asset-item>
      </a-assets>
      <a-marker type="pattern" url="pattern-marker.patt">
        <a-entity
          id="rotatableModel"
          gltf-model="#chaei"
          rotation="-90 0 0"
          scale="1 1 1" class="clickable" ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
  <script>
    document.querySelector("a-scene").addEventListener('loaded', function () {
        // A-Frame 1.5.0 + Three.js r158 向けの設定
        // sRGBEncoding は outputColorSpace に変更されました
        this.renderer.outputColorSpace = THREE.SRGBColorSpace;
        this.renderer.toneMapping = THREE.ACESFilmicToneMapping; // トーンマッピングを有効にする
        this.renderer.toneMappingExposure = 1.0; // トーンマッピングの露出
    });

    document.addEventListener('DOMContentLoaded', function () {
        const rotatableModel = document.querySelector('#rotatableModel');
        let currentYRotation = 0;

        // A-FrameのRaycasterがクリックイベントを正しく検出できるように、
        // カーソルコンポーネントをカメラに追加するか、シーンに設定します。
        // マーカーベースARでは、通常は自動的に設定されますが、明示的に追加することで確実性が増します。
        // <a-entity camera> の代わりに <a-entity camera raycaster="objects: .clickable;"> を試すこともできます。
        // あるいは、a-scene に raycaster を設定します。
        document.querySelector('a-scene').setAttribute('raycaster', 'objects: .clickable;');


        rotatableModel.addEventListener('click', function () {
            console.log('Model clicked!'); // デバッグ用: クリックイベントが発火しているか確認
            currentYRotation += 90;
            if (currentYRotation >= 360) {
                currentYRotation = 0;
            }
            rotatableModel.setAttribute('rotation', `-90 ${currentYRotation} 0`);
        });
    });
  </script>
</html>
