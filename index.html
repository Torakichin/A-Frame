<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.0/dist/aframe-environment-component.min.js"></script>
  </head>

  <body>
    <a-scene xr-mode-ui="enabled: true">

      <!-- デバッグ表示 -->
      <a-entity id="debugText"
                text="value: waiting XR..."
                position="0 2 -2"
                scale="2 2 2"></a-entity>

      <a-entity environment="preset: forest"></a-entity>

      <script>
        AFRAME.registerComponent("xr-stick-debug", {
          init() {
            const scene = this.el.sceneEl;
            const debug = document.getElementById("debugText");

            scene.addEventListener("enter-vr", async () => {
              const session = await scene.renderer.xr.getSession();

              debug.setAttribute("text", "value: XR session started");

              this.session = session;

              session.addEventListener("inputsourceschange", () => {
                debug.setAttribute("text", "value: input source changed");
              });
            });
          },

          tick() {
            const debug = document.getElementById("debugText");
            if (!this.session) return;

            let result = "";

            for (const source of this.session.inputSources) {
              if (!source.gamepad) continue;

              const axes = source.gamepad.axes;
              result += `source: ${source.handedness}\n`;
              result += `axes: ${JSON.stringify(axes)}\n`;
            }

            if (!result) {
              result = "no gamepad axes (inputSources exists)";
            }

            debug.setAttribute("text", "value: " + result);
          }
        });

        document.querySelector("a-scene").setAttribute("xr-stick-debug", "");
      </script>

    </a-scene>
  </body>
</html>
